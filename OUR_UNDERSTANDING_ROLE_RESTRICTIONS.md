# Наше понимание ограничений ролей (для отладки)

## Контекст
Это наше понимание того, как должны работать ограничения ролей в системе. В реальности это будет реализовано заказчиком, но для отладки мы создаем упрощенную версию.

## Наше понимание ролей

### 1. Администратор (admin)
- **Что видит**: Все данные без ограничений
- **Наша реализация**: SQL остается без изменений
- **Пример**: "Покажи всех пользователей" → показывает всех пользователей

### 2. Менеджер (manager) 
- **Что видит**: Данные только своего отдела (IT)
- **Наша реализация**: Добавляем WHERE условие для отдела IT
- **Пример**: "Покажи всех пользователей" → показывает только пользователей отдела IT

### 3. Пользователь (user)
- **Что видит**: Только свои собственные данные
- **Наша реализация**: Добавляем WHERE условие для конкретного пользователя
- **Пример**: "Покажи всех пользователей" → показывает только свой профиль

## Наша текущая реализация

### Для запроса "Покажи всех пользователей"
```sql
-- Администратор (без изменений)
SELECT id, login, email, surname, firstname, department FROM equsers WHERE deleted = false

-- Менеджер (только отдел IT)
SELECT id, login, email, surname, firstname, department FROM equsers WHERE deleted = false AND department = (SELECT id FROM eq_departments WHERE departmentname = 'IT')

-- Пользователь (только свой профиль)
SELECT id, login, email, surname, firstname, department FROM equsers WHERE deleted = false AND login = 'user1'
```

### Для запроса "Покажи поручения за последний месяц"
```sql
-- Администратор (без изменений)
SELECT assignment_number, assignment_date, amount, business_unit_id FROM tbl_principal_assignment WHERE assignment_date >= CURRENT_DATE - INTERVAL '1 month' ORDER BY assignment_date DESC

-- Менеджер (только отдел IT)
SELECT assignment_number, assignment_date, amount, business_unit_id FROM tbl_principal_assignment WHERE assignment_date >= CURRENT_DATE - INTERVAL '1 month' AND department_id = (SELECT id FROM eq_departments WHERE departmentname = 'IT') ORDER BY assignment_date DESC

-- Пользователь (только свои поручения)
SELECT assignment_number, assignment_date, amount, business_unit_id FROM tbl_principal_assignment WHERE assignment_date >= CURRENT_DATE - INTERVAL '1 month' AND user_id = (SELECT id FROM equsers WHERE login = 'user1') ORDER BY assignment_date DESC
```

## Мок-данные для тестирования

### Администратор
- Пользователи: 4 пользователя (все)
- Поручения: 4 поручения (все)

### Менеджер
- Пользователи: 2 пользователя (только IT отдел)
- Поручения: 2 поручения (только IT отдел)

### Пользователь
- Пользователи: 1 пользователь (только свой профиль)
- Поручения: 1 поручение (только свои)

## Ограничения нашей реализации

1. **Упрощенная логика**: Мы используем простые WHERE условия
2. **Мок-данные**: Реальные данные будут в базе заказчика
3. **Жестко заданные значения**: В реальности будет динамически определяться
4. **Отсутствие сложной бизнес-логики**: Заказчик реализует сложные правила

## Что мы тестируем

1. **Генерация SQL**: Vanna AI генерирует правильный SQL
2. **Применение ограничений**: SQL модифицируется согласно роли
3. **Отображение результатов**: Пользователь видит только разрешенные данные
4. **Логирование**: Видим весь процесс в логах

## Заключение

Это наша упрощенная реализация для отладки. В реальности заказчик будет:
- Определять сложные бизнес-правила
- Интегрироваться с их системой ролей
- Обрабатывать сложные случаи
- Обеспечивать безопасность

Мы же создаем простую версию для демонстрации концепции.
