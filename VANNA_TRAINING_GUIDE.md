# –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±—É—á–µ–Ω–∏—é –∏ –¥–æ–æ–±—É—á–µ–Ω–∏—é Vanna AI –∞–≥–µ–Ω—Ç–∞

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è](#–æ–±–∑–æ—Ä-–ø—Ä–æ—Ü–µ—Å—Å–∞-–æ–±—É—á–µ–Ω–∏—è)
2. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–¥–∞–Ω–Ω—ã—Ö-–¥–ª—è-–æ–±—É—á–µ–Ω–∏—è)
3. [–ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è](#–ø—Ä–æ—Ü–µ—Å—Å-–æ–±—É—á–µ–Ω–∏—è)
4. [–î–æ–æ–±—É—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞](#–¥–æ–æ–±—É—á–µ–Ω–∏–µ-–∞–≥–µ–Ω—Ç–∞)
5. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–≤–∞–ª–∏–¥–∞—Ü–∏—è)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ—Ç–ª–∞–¥–∫–∞)
7. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

## –û–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è

Vanna AI –∞–≥–µ–Ω—Ç –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ —á–µ—Ç—ã—Ä–µ—Ö —Ç–∏–ø–∞—Ö –¥–∞–Ω–Ω—ã—Ö:

1. **DDL (Data Definition Language)** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ–ø–∏—Å–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ —Ç–∞–±–ª–∏—Ü
3. **SQL –ø—Ä–∏–º–µ—Ä—ã** - –ø–∞—Ä—ã –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
4. **–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ INFORMATION_SCHEMA

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—É—á–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   DDL —Ñ–∞–π–ª—ã     ‚îÇ    ‚îÇ  –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è   ‚îÇ    ‚îÇ  SQL –ø—Ä–∏–º–µ—Ä—ã    ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ - CREATE TABLE  ‚îÇ    ‚îÇ - –û–ø–∏—Å–∞–Ω–∏–µ –ë–î  ‚îÇ    ‚îÇ - –í–æ–ø—Ä–æ—Å—ã       ‚îÇ
‚îÇ - ALTER TABLE   ‚îÇ    ‚îÇ - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚îÇ    ‚îÇ - SQL –∑–∞–ø—Ä–æ—Å—ã   ‚îÇ
‚îÇ - INDEXES       ‚îÇ    ‚îÇ - –°–≤—è–∑–∏ —Ç–∞–±–ª–∏—Ü  ‚îÇ    ‚îÇ - –ö–æ–Ω—Ç–µ–∫—Å—Ç      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Vanna AI Agent ‚îÇ
                    ‚îÇ                 ‚îÇ
                    ‚îÇ - –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î   ‚îÇ
                    ‚îÇ - LLM (ProxyAPI) ‚îÇ
                    ‚îÇ - pgvector       ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  INFORMATION_   ‚îÇ
                    ‚îÇ  SCHEMA         ‚îÇ
                    ‚îÇ                 ‚îÇ
                    ‚îÇ - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ‚îÇ
                    ‚îÇ   –æ–±—É—á–µ–Ω–∏–µ      ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

### 1. DDL —Ñ–∞–π–ª—ã (`training_data/ddl_statements.sql`)

–°–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```sql
-- –ü—Ä–∏–º–µ—Ä DDL –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
CREATE TABLE equsers (
    id UUID PRIMARY KEY,
    login VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    surname VARCHAR(255),
    firstname VARCHAR(255),
    department UUID REFERENCES eq_departments(id),
    accessgranted BOOLEAN DEFAULT true,
    creationdatetime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted BOOLEAN DEFAULT false
);

CREATE TABLE eq_departments (
    id UUID PRIMARY KEY,
    departmentname VARCHAR(255) NOT NULL,
    parentid UUID REFERENCES eq_departments(id),
    description TEXT,
    creationdatetime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted BOOLEAN DEFAULT false
);
```

### 2. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`training_data/documentation.txt`)

–û–ø–∏—Å–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ —Å–≤—è–∑–µ–π:

```
DocStructureSchema - —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

–û–°–ù–û–í–ù–´–ï –¢–ê–ë–õ–ò–¶–´:

1. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò –ò –†–û–õ–ò:
- equsers: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (–ª–æ–≥–∏–Ω, email, –æ—Ç–¥–µ–ª, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞)
- eq_departments: –æ—Ç–¥–µ–ª—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –æ—Ç–¥–µ–ª)
- eqgroups: –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã, –æ–ø–∏—Å–∞–Ω–∏–µ)
- eqroles: —Ä–æ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏, –æ–ø–∏—Å–∞–Ω–∏–µ)

2. –ë–ò–ó–ù–ï–°-–î–ê–ù–ù–´–ï:
- tbl_business_unit: –ø—Ä–æ—Ñ–∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –ò–ù–ù, –ö–ü–ü, –û–ì–†–ù)
- tbl_principal_assignment: –ø–æ—Ä—É—á–µ–Ω–∏—è –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∞ (–Ω–æ–º–µ—Ä, –¥–∞—Ç–∞, —Å—É–º–º–∞, –∫–ª–∏–µ–Ω—Ç)
- tbl_incoming_payments: –≤—Ö–æ–¥—è—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏ (–Ω–æ–º–µ—Ä, –¥–∞—Ç–∞, —Å—É–º–º–∞, –ø–æ—Ä—É—á–µ–Ω–∏–µ)

–ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê:
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –æ—Ç–¥–µ–ª—É (equsers.department ‚Üí eq_departments.id)
- –ü–æ—Ä—É—á–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (tbl_principal_assignment.business_unit_id ‚Üí tbl_business_unit.id)
- –ü–ª–∞—Ç–µ–∂–∏ —Å–≤—è–∑–∞–Ω—ã —Å –ø–æ—Ä—É—á–µ–Ω–∏—è–º–∏ (tbl_incoming_payments.assignment_id ‚Üí tbl_principal_assignment.id)
```

### 3. SQL –ø—Ä–∏–º–µ—Ä—ã (`training_data/sql_examples.json`)

–ü–∞—Ä—ã –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ:

```json
[
  {
    "question": "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
    "sql": "SELECT id, login, email, surname, firstname, department FROM equsers WHERE deleted = false"
  },
  {
    "question": "–°–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª–æ–≤",
    "sql": "SELECT id, departmentname, parentid, description FROM eq_departments WHERE deleted = false"
  },
  {
    "question": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ –æ—Ç–¥–µ–ª–∞–º",
    "sql": "SELECT u.login, u.email, u.surname, u.firstname, d.departmentname FROM equsers u LEFT JOIN eq_departments d ON u.department = d.id WHERE u.deleted = false"
  },
  {
    "question": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –æ—Ç–¥–µ–ª–∞–º",
    "sql": "SELECT d.departmentname, COUNT(u.id) as user_count FROM eq_departments d LEFT JOIN equsers u ON d.id = u.department AND u.deleted = false WHERE d.deleted = false GROUP BY d.id, d.departmentname ORDER BY user_count DESC"
  },
  {
    "question": "–ü–æ—Ä—É—á–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü",
    "sql": "SELECT pa.assignment_number, pa.assignment_date, pa.amount, bu.business_unit_name FROM tbl_principal_assignment pa JOIN tbl_business_unit bu ON pa.business_unit_id = bu.id WHERE pa.assignment_date >= CURRENT_DATE - INTERVAL '1 month' AND pa.deleted = false ORDER BY pa.assignment_date DESC"
  }
]
```

### 4. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (`training_data/metadata.json`)

–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```json
{
  "database": "DocStructureSchema",
  "total_tables": 12,
  "main_tables": ["equsers", "eq_departments", "tbl_business_unit", "tbl_principal_assignment"],
  "business_domains": ["–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", "–û—Ç–¥–µ–ª—ã", "–ö–ª–∏–µ–Ω—Ç—ã", "–ü–æ—Ä—É—á–µ–Ω–∏—è", "–ü–ª–∞—Ç–µ–∂–∏"],
  "description": "–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"
}
```

## –ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è

### 1. –ü–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
python enhanced_training_script.py
```

**–õ–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞:**

```
2025-01-11 23:30:00 - INFO - üéì –ù–∞—á–∞–ª–æ –ø–æ–ª–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞...
2025-01-11 23:30:01 - INFO - ‚úÖ –û–±—É—á–µ–Ω–∏–µ –Ω–∞ DDL –∑–∞–≤–µ—Ä—à–µ–Ω–æ
2025-01-11 23:30:02 - INFO - ‚úÖ –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
2025-01-11 23:30:03 - INFO - ‚úÖ –û–±—É—á–µ–Ω–∏–µ –Ω–∞ SQL –ø—Ä–∏–º–µ—Ä–∞—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ
2025-01-11 23:30:04 - INFO - ‚úÖ –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ
2025-01-11 23:30:05 - INFO - üîç –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
2025-01-11 23:30:06 - INFO - üìä –ù–∞–π–¥–µ–Ω–æ 45 –∫–æ–ª–æ–Ω–æ–∫ –≤ —Å—Ö–µ–º–µ
2025-01-11 23:30:07 - INFO - üìã –°–æ–∑–¥–∞–Ω –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è —Å 12 —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
2025-01-11 23:30:08 - INFO - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å—Ö–µ–º–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
2025-01-11 23:30:09 - INFO - ‚úÖ –ü–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—É—á–µ–Ω–∏—è

```python
class EnhancedVannaTrainer:
    def train_full(self) -> bool:
        """–ü–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞"""
        # 1. DDL –æ–±—É—á–µ–Ω–∏–µ
        self.train_on_ddl()
        
        # 2. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
        self.train_on_documentation()
        
        # 3. SQL –ø—Ä–∏–º–µ—Ä—ã
        self.train_on_sql_examples()
        
        # 4. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
        self.train_on_metadata()
        
        # 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å—Ö–µ–º–µ
        self.train_on_database_schema()
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å—Ö–µ–º–µ

```python
def train_on_database_schema(self) -> bool:
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    # –ü–æ–ª—É—á–∞–µ–º —Å—Ö–µ–º—É –∏–∑ INFORMATION_SCHEMA
    schema_query = """
    SELECT 
        table_name,
        column_name,
        data_type,
        is_nullable,
        column_default,
        character_maximum_length
    FROM information_schema.columns 
    WHERE table_schema = 'public'
    ORDER BY table_name, ordinal_position
    """
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
    df_schema = self.vanna.run_sql(schema_query)
    
    # –°–æ–∑–¥–∞–µ–º –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è
    plan = self.vanna.get_training_plan_generic(df_schema)
    
    # –û–±—É—á–∞–µ–º –Ω–∞ –ø–ª–∞–Ω–µ
    self.vanna.train(plan=plan)
```

## –î–æ–æ–±—É—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö SQL –ø—Ä–∏–º–µ—Ä–æ–≤

**–®–∞–≥ 1:** –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `training_data/sql_examples.json`:

```json
[
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã ...
  {
    "question": "–ü–æ–∫–∞–∂–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü",
    "sql": "SELECT u.login, u.email, u.surname, u.firstname, d.departmentname FROM equsers u LEFT JOIN eq_departments d ON u.department = d.id WHERE u.deleted = false AND u.creationdatetime >= CURRENT_DATE - INTERVAL '1 month'"
  },
  {
    "question": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º –ø–æ –º–µ—Å—è—Ü–∞–º",
    "sql": "SELECT DATE_TRUNC('month', payment_date) as month, COUNT(*) as payment_count, SUM(amount) as total_amount FROM tbl_incoming_payments WHERE deleted = false GROUP BY DATE_TRUNC('month', payment_date) ORDER BY month DESC"
  }
]
```

**–®–∞–≥ 2:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–æ–æ–±—É—á–µ–Ω–∏–µ:

```bash
python incremental_training.py --type sql_examples
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–®–∞–≥ 1:** –û–±–Ω–æ–≤–∏—Ç–µ `training_data/documentation.txt`:

```
// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ...

–ù–û–í–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –≥–µ–æ–≥—Ä–∞—Ñ–∏—è
- –û—Ç—á–µ—Ç—ã –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º, –≤–∞–ª—é—Ç–∞–º
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç–¥–µ–ª–æ–≤: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –∑–∞–≥—Ä—É–∑–∫–∞
```

**–®–∞–≥ 2:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–æ–æ–±—É—á–µ–Ω–∏–µ:

```bash
python incremental_training.py --type documentation
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü

**–®–∞–≥ 1:** –û–±–Ω–æ–≤–∏—Ç–µ DDL –≤ `training_data/ddl_statements.sql`:

```sql
-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã ...

CREATE TABLE tbl_analytics (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES equsers(id),
    action_type VARCHAR(100),
    action_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    metadata JSONB,
    creationdatetime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted BOOLEAN DEFAULT false
);
```

**–®–∞–≥ 2:** –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

```
// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ...

–ê–ù–ê–õ–ò–¢–ò–ö–ê:
- tbl_analytics: –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–∏–ø, –¥–∞—Ç–∞, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
- –°–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏: tbl_analytics.user_id ‚Üí equsers.id
```

**–®–∞–≥ 3:** –î–æ–±–∞–≤—å—Ç–µ SQL –ø—Ä–∏–º–µ—Ä—ã:

```json
{
  "question": "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –¥–µ–Ω—å",
  "sql": "SELECT u.login, COUNT(a.id) as actions_count FROM equsers u LEFT JOIN tbl_analytics a ON u.id = a.user_id WHERE a.action_date >= CURRENT_DATE - INTERVAL '1 day' AND u.deleted = false GROUP BY u.id, u.login ORDER BY actions_count DESC"
}
```

**–®–∞–≥ 4:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –¥–æ–æ–±—É—á–µ–Ω–∏–µ:

```bash
python incremental_training.py --type full
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
python src/vanna/testing_script.py
```

**–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤:**

```python
def test_agent():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞"""
    test_cases = [
        {
            "question": "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
            "expected_tables": ["equsers"],
            "expected_columns": ["id", "login", "email"]
        },
        {
            "question": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º",
            "expected_tables": ["eq_departments", "equsers"],
            "expected_columns": ["departmentname", "user_count"]
        }
    ]
    
    for test_case in test_cases:
        result = vanna.generate_sql(test_case["question"])
        assert result is not None
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü –∏ –∫–æ–ª–æ–Ω–æ–∫
```

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è SQL

```python
def validate_sql(sql: str) -> bool:
    """–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SQL"""
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
        parsed = sqlparse.parse(sql)[0]
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        assert "SELECT" in sql.upper()
        assert "FROM" in sql.upper()
        
        return True
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ SQL: {e}")
        return False
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è

```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('training.log'),
        logging.StreamHandler()
    ]
)
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è

```python
def monitor_training_quality():
    """–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—É—á–µ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
    training_data = vanna.get_training_data()
    logger.info(f"üìä –û–±—É—á–µ–Ω–æ –ø—Ä–∏–º–µ—Ä–æ–≤: {len(training_data)}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Ç–∏–ø–æ–≤
    types = training_data['content_type'].value_counts()
    logger.info(f"üìà –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö: {types.to_dict()}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    recent = training_data.head(10)
    logger.info(f"üïí –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: {recent['content_type'].tolist()}")
```

### 3. –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

```python
def debug_training_issues():
    """–û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º –æ–±—É—á–µ–Ω–∏—è"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
    try:
        test_sql = "SELECT 1 as test"
        result = vanna.run_sql(test_sql)
        logger.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç")
    except Exception as e:
        logger.error(f"‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å –ë–î: {e}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º ProxyAPI
    try:
        test_question = "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å"
        result = vanna.generate_sql(test_question)
        logger.info("‚úÖ ProxyAPI —Ä–∞–±–æ—Ç–∞–µ—Ç")
    except Exception as e:
        logger.error(f"‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å ProxyAPI: {e}")
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ

```bash
# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
python clear_training_data.py

# –ü–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
python enhanced_training_script.py

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
python src/vanna/testing_script.py
```

### 2. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–æ–æ–±—É—á–µ–Ω–∏–µ

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö SQL –ø—Ä–∏–º–µ—Ä–æ–≤
python incremental_training.py --type sql_examples --file new_examples.json

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
python incremental_training.py --type documentation --file updated_docs.txt

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü
python incremental_training.py --type ddl --file new_tables.sql
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–æ–±—É—á–µ–Ω–∏–µ

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–æ–±—É—á–µ–Ω–∏—è
python setup_auto_retraining.py --schedule daily --monitor_changes

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î
python monitor_schema_changes.py --auto_retrain
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è Vanna AI –∞–≥–µ–Ω—Ç–∞ –≤–∫–ª—é—á–∞–µ—Ç:

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫—É –¥–∞–Ω–Ω—ã—Ö** - DDL, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, SQL –ø—Ä–∏–º–µ—Ä—ã, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
2. **–ü–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** - –ø–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ** - –Ω–∞ —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ INFORMATION_SCHEMA
4. **–î–æ–æ–±—É—á–µ–Ω–∏–µ** - –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è
6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–æ–±—É—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
