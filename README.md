# NL‚ÜíSQL —Å–∏—Å—Ç–µ–º–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Vanna AI

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Vanna AI –∏ FastAPI. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –∏ –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö DocStructureSchema.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí FastAPI ‚Üí Vanna AI ‚Üí SQL —à–∞–±–ª–æ–Ω ‚Üí API –∑–∞–∫–∞–∑—á–∏–∫–∞ ‚Üí PostgreSQL ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **FastAPI —Å–µ—Ä–≤–µ—Ä** - REST API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Vanna AI** - RAG –º–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL
- **ChromaDB** - –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö DocStructureSchema
- **API –∑–∞–∫–∞–∑—á–∏–∫–∞** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–æ–ª–µ–≤—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
cp config.env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
python -m src.api.main
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
curl http://localhost:8000/health
```

## üìã API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

- `GET /` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
- `POST /query` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–∞
- `POST /query/execute` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL
- `POST /training/example` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞ –æ–±—É—á–µ–Ω–∏—è
- `GET /training/status` - –°—Ç–∞—Ç—É—Å –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL:
```bash
curl -X POST "http://localhost:8000/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
    "user_id": "123",
    "role": "admin"
  }'
```

#### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X POST "http://localhost:8000/query/execute" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "–°–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ?",
    "user_id": "123",
    "role": "manager"
  }'
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `OPENAI_API_KEY` - API –∫–ª—é—á OpenAI
- `DATABASE_URL` - URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
- `CUSTOMER_API_URL` - URL API –∑–∞–∫–∞–∑—á–∏–∫–∞
- `VANNA_CHROMA_DB_PATH` - –ü—É—Ç—å –∫ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å PostgreSQL –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö DocStructureSchema, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π:
- 200 —Ç–∞–±–ª–∏—Ü
- 1,124 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- 502 –∫–ª–∏–µ–Ω—Ç–∞
- 1,959 –ø–æ—Ä—É—á–µ–Ω–∏–π
- 1,665 –ø–ª–∞—Ç–µ–∂–µ–π

## üß† –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ:
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞:
- DDL —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ü—Ä–∏–º–µ—Ä–∞—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤

### –†—É—á–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ:
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞ –æ–±—É—á–µ–Ω–∏—è
await query_service.add_training_example(
    question="–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
    sql="SELECT * FROM equsers",
    user_id="123"
)
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å –¥–æ—Å—Ç—É–ø–∞
- Row Level Security (RLS) –≤ PostgreSQL
- –í–∞–ª–∏–¥–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –æ—Ç–¥–µ–ª–∞–º –∏ —Ä–æ–ª—è–º

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:
```bash
curl http://localhost:8000/health
```

### –õ–æ–≥–∏:
```bash
tail -f logs/app.log
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest tests/

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=src tests/
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](ARCHITECTURE_VANNA_INTEGRATION.md)
- [–ê–Ω–∞–ª–∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](DATABASE_SCHEMA_ANALYSIS.md)
- [–û—Ç—á–µ—Ç –æ –∑–∞–≥—Ä—É–∑–∫–µ](DATABASE_LOAD_REPORT.md)

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:
```
sql4A/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/           # FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ models/        # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/      # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ vanna/         # Vanna AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docs/              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tests/             # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
pip install -r requirements.txt
pre-commit install
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üîó –°—Å—ã–ª–∫–∏

- [Vanna AI](https://github.com/vanna-ai/vanna)
- [FastAPI](https://fastapi.tiangolo.com/)
- [PostgreSQL](https://www.postgresql.org/)
- [ChromaDB](https://www.trychroma.com/)