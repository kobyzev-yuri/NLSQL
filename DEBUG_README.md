# üêõ –û—Ç–ª–∞–¥–∫–∞ NL‚ÜíSQL —Å–∏—Å—Ç–µ–º—ã

## üéØ **–¶–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏**

–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ pipeline –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è NL‚ÜíSQL —Å–∏—Å—Ç–µ–º—ã —Å mock API –∑–∞–∫–∞–∑—á–∏–∫–∞ –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–ª–∞–¥–∫–∏**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Web Interface‚îÇ    ‚îÇ   NL‚ÜíSQL API     ‚îÇ    ‚îÇ Mock Customer   ‚îÇ
‚îÇ   (localhost:3000)‚îÇ    ‚îÇ   (localhost:8000)‚îÇ    ‚îÇ API (localhost:8080)‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å‚îÇ    ‚îÇ ‚Ä¢ FastAPI       ‚îÇ    ‚îÇ ‚Ä¢ Mock API      ‚îÇ
‚îÇ ‚Ä¢ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚îÇ    ‚îÇ ‚Ä¢ Vanna AI      ‚îÇ    ‚îÇ ‚Ä¢ –†–æ–ª–µ–≤—ã–µ       ‚îÇ
‚îÇ ‚Ä¢ –û—Ç–ª–∞–¥–∫–∞      ‚îÇ    ‚îÇ ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL ‚îÇ    ‚îÇ   –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üöÄ **–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫**

### **1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```bash
pip install -r requirements.txt
```

### **2. –ó–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã**
```bash
python run_system.py
```

### **3. –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º**
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** http://localhost:3000
- **NL‚ÜíSQL API:** http://localhost:8000
- **Mock Customer API:** http://localhost:8080
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** http://localhost:8000/docs

## üîß **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã**

### **1. Mock Customer API (`src/mock_customer_api.py`)**
–ò–º–∏—Ç–∏—Ä—É–µ—Ç API –∑–∞–∫–∞–∑—á–∏–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `POST /api/sql/execute` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL —Å —Ä–æ–ª–µ–≤—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- `POST /api/sql/validate` - –≤–∞–ª–∏–¥–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- `GET /api/users/{user_id}/permissions` - –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

**–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å:**
- `admin` - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- `manager` - –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –æ—Ç–¥–µ–ª–∞
- `user` - –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–∏–º –¥–∞–Ω–Ω—ã–º

### **2. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`src/web_interface.py`)**
HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

**–§—É–Ω–∫—Ü–∏–∏:**
- –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–æ–ª–∏
- –í–≤–æ–¥ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API

### **3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—É—á–µ–Ω–∏—è (`src/vanna/training_data_preparation.py`)**
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Vanna AI:

**–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:**
- DDL –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ü—Ä–∏–º–µ—Ä—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìä **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**

### **Mock –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
```json
{
  "admin": {
    "role": "admin",
    "permissions": ["read", "write", "delete", "admin"]
  },
  "manager": {
    "role": "manager", 
    "permissions": ["read", "write"],
    "restrictions": ["department_only"]
  },
  "user": {
    "role": "user",
    "permissions": ["read"],
    "restrictions": ["own_data_only"]
  }
}
```

### **Mock –¥–∞–Ω–Ω—ã–µ:**
- **equsers** - 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **tbl_business_unit** - 2 –∫–ª–∏–µ–Ω—Ç–∞
- **tbl_principal_assignment** - 2 –ø–æ—Ä—É—á–µ–Ω–∏—è

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **1. –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
- "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
- "–°–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª–æ–≤"
- "–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã"

### **2. –°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
- "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ –æ—Ç–¥–µ–ª–∞–º"
- "–ü–æ—Ä—É—á–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏"
- "–ü–ª–∞—Ç–µ–∂–∏ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º"

### **3. –†–æ–ª–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- `admin` - –≤–∏–¥–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- `manager` - –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª–∞
- `user` - –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

## üîç **–û—Ç–ª–∞–¥–∫–∞**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API:**
```bash
# NL‚ÜíSQL API
curl http://localhost:8000/health

# Mock Customer API  
curl http://localhost:8080/health

# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
curl http://localhost:3000/api/status
```

### **2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:**
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL
curl -X POST "http://localhost:8000/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
    "user_id": "admin",
    "role": "admin"
  }'

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
curl -X POST "http://localhost:8000/query/execute" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "–°–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ?",
    "user_id": "manager",
    "role": "manager"
  }'
```

### **3. –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/app.log

# –ò–ª–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ run_system.py
```

## üìã **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Vanna AI**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**
```python
from src.vanna.training_data_preparation import VannaTrainingDataPreparator

preparator = VannaTrainingDataPreparator()
preparator.save_training_data("./training_data")
```

### **–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `training_data/ddl_statements.sql` - DDL –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- `training_data/documentation.txt` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `training_data/sql_examples.json` - –ø—Ä–∏–º–µ—Ä—ã SQL
- `training_data/metadata.json` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

## üéØ **–°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

### **1. –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É: `python run_system.py`
2. –û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: http://localhost:3000
3. –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `admin`
4. –í–≤–µ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å: "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
5. –ù–∞–∂–∞—Ç—å "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SQL"
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL
7. –ù–∞–∂–∞—Ç—å "–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å"
8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–µ–≤—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:**
1. –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `user`
2. –í–≤–µ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å: "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:**
1. –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `manager`
2. –í–≤–µ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å: "–ü–æ—Ä—É—á–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏"
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JOIN –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üö® **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫**

### **–ü—Ä–æ–±–ª–µ–º–∞: API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep uvicorn

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
python run_system.py
```

### **–ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ Vanna AI**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å OpenAI API –∫–ª—é—á
export OPENAI_API_KEY="your-key-here"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ChromaDB
ls -la chroma_db/
```

### **–ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PostgreSQL
PGPASSWORD=1234 psql -h localhost -p 5432 -U postgres -d test_docstructure -c "SELECT 1;"
```

## üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

### **–ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã:**
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—à–∏–±–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL
- –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### **–õ–æ–≥–∏:**
- NL‚ÜíSQL API: –∫–æ–Ω—Å–æ–ª—å
- Mock Customer API: –∫–æ–Ω—Å–æ–ª—å  
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –∫–æ–Ω—Å–æ–ª—å

## üîÑ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ OpenAI API –∫–ª—é—á–∞**
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–π PostgreSQL**
3. **–û–±—É—á–µ–Ω–∏–µ Vanna AI –Ω–∞ –¥–∞–Ω–Ω—ã—Ö**
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏**
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º API –∑–∞–∫–∞–∑—á–∏–∫–∞**

## üìö **–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏**

- [Vanna AI Documentation](https://vanna.ai/docs/)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [ChromaDB Documentation](https://docs.trychroma.com/)
